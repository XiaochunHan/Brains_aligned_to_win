---
title: "Analysis_Permutation_control"
author: "Xiaochun Han"
date: "2025-12-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
source("../../utils/functions_library.R")
load_packages(c("dplyr", "caret", "e1071","ggplot2", "pROC", "reshape2", "rstatix","pROC"))
```

## Import data
```{r impart data}
dataset_pseudo <- read.csv('Pseudo_pair_control.csv',header=TRUE,sep=",")
dataset_circular <- read.csv('Circular_time_control.csv',header=TRUE,sep=",")
dataset_machine <- read.csv('Same_machine_control.csv',header=TRUE,sep=",")
```

### Pseudo_pair_control
```{r permute_pseudo}
acc_low_25 = sort(dataset_pseudo$Var1)[25]
acc_top_25 = sort(dataset_pseudo$Var1)[975]
dataset_pseudo$ci95 = rep(0,1000)
dataset_pseudo$ci95[(dataset_pseudo$Var1<acc_low_25|dataset_pseudo$Var1>acc_top_25)] = 1
acc_all = 0.9212
p_perm = mean(acc_all<dataset_pseudo$Var1)

p<-ggplot(dataset_pseudo, aes(x = Var1, fill = as.factor(ci95))) +
    geom_histogram(colour = "#4C4C4C", bins = 61) + 
    scale_fill_manual(values = c("white","#B095C6"))+
    geom_vline(aes(xintercept = acc_all), color = "#B095C6", linewidth = 2) + theme_classic()+xlim(0.5,1) + 
    labs(x = "Win-Lose Prediction Accuracy") + theme(text = element_text(size = 25),legend.position="none",axis.ticks.length=unit(-0.1, "cm"))
print(p)
```

### Circular_time_control
```{r permute_circular}
acc_low_25 = sort(dataset_circular$Var1)[25]
acc_top_25 = sort(dataset_circular$Var1)[975]
dataset_circular$ci95 = rep(0,1000)
dataset_circular$ci95[(dataset_circular$Var1<acc_low_25|dataset_circular$Var1>acc_top_25)] = 1
acc_all = 0.9212
p_perm = mean(acc_all<dataset_circular$Var1)

p<-ggplot(dataset_circular, aes(x = Var1, fill = as.factor(ci95))) +
    geom_histogram(colour = "#4C4C4C", bins = 61) + 
    scale_fill_manual(values = c("white","#B095C6"))+
    geom_vline(aes(xintercept = acc_all), color = "#B095C6", linewidth = 2) + theme_classic()+xlim(0.7,1) + 
    labs(x = "Win-Lose Prediction Accuracy") + theme(text = element_text(size = 25),legend.position="none",axis.ticks.length=unit(-0.1, "cm"))
print(p)
```

### Same_machine_control
```{r permute_machine}
acc_low_25 = sort(dataset_machine$Var1)[25]
acc_top_25 = sort(dataset_machine$Var1)[975]
dataset_machine$ci95 = rep(0,1000)
dataset_machine$ci95[(dataset_machine$Var1<acc_low_25|dataset_machine$Var1>acc_top_25)] = 1
acc_all = 0.9212
p_perm = mean(acc_all<dataset_machine$Var1)

p<-ggplot(dataset_machine, aes(x = Var1, fill = as.factor(ci95))) +
    geom_histogram(colour = "#4C4C4C", bins = 61) + 
    scale_fill_manual(values = c("white","#B095C6"))+
    geom_vline(aes(xintercept = acc_all), color = "#B095C6", linewidth = 2) + theme_classic()+xlim(0.7,1) + 
    labs(x = "Win-Lose Prediction Accuracy") + theme(text = element_text(size = 25),legend.position="none",axis.ticks.length=unit(-0.1, "cm"))
print(p)
```

```{r permute_machine}
library(stringr)

# 从 dataset_machine$sub_folder 中提取数字
# 使用正则表达式匹配"permute"后面的数字序列
extracted_numbers <- as.numeric(str_extract(dataset_machine$sub_folder, "(?<=permute)\\d+"))

# 检查是否成功提取了999个数字（因为您提到有999行）
print(paste("成功提取的数字个数:", length(extracted_numbers)))

# 找出1到1000范围内缺失的数字
all_numbers <- 1:1000
missing_numbers <- setdiff(all_numbers, extracted_numbers)

# 输出结果
if (length(missing_numbers) == 0) {
  print("所有1到1000的数字都存在。")
} else {
  print(paste("缺失的数字是:", paste(missing_numbers, collapse = ", ")))
}
```